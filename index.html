<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>School Library Management</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; color: #333; }
    header { background: #2c5282; color: #fff; padding: 1rem; text-align: center; }
    nav { display: flex; justify-content: center; background: #2b6cb0; padding: 0.5rem; }
    nav button { background: none; border: none; color: #fff; padding: 0.5rem 1rem; cursor: pointer; }
    nav button.active { background: #2c5282; font-weight: bold; border-radius: 5px; }
    section { display: none; padding: 1rem; }
    section.active { display: block; }
    .form-group { margin-bottom: 0.75rem; }
    .form-group label { display: block; margin-bottom: 0.25rem; }
    .form-group input, select { width: 100%; padding: 0.5rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background: #edf2f7; }
    .mode-switch { display: flex; margin-bottom: 1rem; }
    .mode-btn { flex: 1; text-align: center; background: #e2e8f0; padding: 0.5rem; cursor: pointer; }
    .mode-btn.active { background: #cbd5e0; }
    .notification { padding: 0.5rem; margin: 0.5rem 0; border-radius: 4px; }
    .success { background-color: #c6f6d5; color: #22543d; }
    .error { background-color: #fed7d7; color: #742a2a; }
    button.danger { background: red; color: white; border: none; padding: 0.3rem 0.5rem; cursor: pointer; border-radius: 3px; }
  </style>
</head>
<body>
  <header>
    <h1>üìö School Library Management</h1>
  </header>
  <nav>
    <button class="nav-tab" onclick="showTab('dashboard', event)">Dashboard</button>
    <button class="nav-tab" onclick="showTab('books', event)">Books</button>
    <button class="nav-tab" onclick="showTab('students', event)">Students</button>
    <button class="nav-tab" onclick="showTab('borrow', event)">Borrow/Return</button>
    <button onclick="exportData()">üì§ Export Data</button>
  </nav>
  <main>
    <section id="dashboard" class="active">
      <h2>üìä Dashboard</h2>
      <p>Total Books: <span id="totalBooks">0</span></p>
      <p>Total Students: <span id="totalStudents">0</span></p>
      <p>Currently Borrowed: <span id="totalBorrowed">0</span></p>
    </section>

    <section id="books">
      <h2>üìñ Books</h2>
      <div class="mode-switch">
        <div class="mode-btn active" onclick="switchBookMode('single', event)">üìñ Add Single Book</div>
        <div class="mode-btn" onclick="switchBookMode('bulk', event)">üìö Add Multiple Books</div>
      </div>
      <div id="singleBookForm">
        <div class="form-group"><label>Title</label><input type="text" id="bookTitle"></div>
        <div class="form-group"><label>Author</label><input type="text" id="bookAuthor"></div>
        <div class="form-group"><label>ISBN</label><input type="text" id="bookISBN"></div>
        <button onclick="addBook()">Add Book</button>
      </div>
      <div id="bulkBookForm" style="display:none;">
        <div class="form-group"><label>Paste Books (Title,Author,ISBN per line)</label><textarea id="bulkBooks" rows="5" style="width:100%;"></textarea></div>
        <button onclick="addBulkBooks()">Add Books</button>
      </div>
      <div class="form-group"><input type="text" id="bookSearch" oninput="displayBooks()" placeholder="üîç Search books..."></div>
      <div id="bookList"></div>
    </section>

    <section id="students">
      <h2>üë©‚Äçüéì Students</h2>
      <div class="form-group"><label>Name</label><input type="text" id="studentName"></div>
      <div class="form-group"><label>Grade</label><input type="text" id="studentGrade"></div>
      <div class="form-group"><label>Email</label><input type="email" id="studentEmail"></div>
      <button onclick="addStudent()">Add Student</button>
      <div class="form-group"><input type="text" id="studentSearch" oninput="displayStudents()" placeholder="üîç Search students..."></div>
      <div id="studentList"></div>
    </section>

    <section id="borrow">
      <h2>üîÑ Borrow / Return</h2>
      <div class="form-group"><label>Student</label><select id="borrowStudent"></select></div>
      <div class="form-group"><label>Book</label><select id="borrowBook"></select></div>
      <button onclick="borrowBook()">Borrow</button>
      <h3>Return Book</h3>
      <div id="returnList"></div>
    </section>
  </main>

  <div id="notification"></div>

  <script>
    let books = JSON.parse(localStorage.getItem("books")) || [];
    let students = JSON.parse(localStorage.getItem("students")) || [];
    let borrowings = JSON.parse(localStorage.getItem("borrowings")) || [];

    function saveData() {
      localStorage.setItem("books", JSON.stringify(books));
      localStorage.setItem("students", JSON.stringify(students));
      localStorage.setItem("borrowings", JSON.stringify(borrowings));
    }

    function showNotification(message, type = 'success') {
      const div = document.createElement("div");
      div.className = `notification ${type}`;
      div.innerText = message;
      document.getElementById("notification").appendChild(div);
      setTimeout(() => div.remove(), 3000);
    }

    function showTab(tab, event) {
      document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
      document.querySelector(`#${tab}`).classList.add("active");
      document.querySelectorAll(".nav-tab").forEach(b => b.classList.remove("active"));
      event.target.classList.add("active");
      localStorage.setItem("activeTab", tab);
      updateDashboard();
      displayBooks();
      displayStudents();
      updateBorrowDropdowns();
    }

    window.onload = () => {
      const savedTab = localStorage.getItem("activeTab") || "dashboard";
      const btn = document.querySelector(`.nav-tab[onclick*="${savedTab}"]`);
      if (btn) btn.click();
      updateDashboard();
      displayBooks();
      displayStudents();
    };

    function switchBookMode(mode, event) {
      document.querySelectorAll(".mode-btn").forEach(btn => btn.classList.remove("active"));
      event.target.classList.add("active");
      document.getElementById("singleBookForm").style.display = mode === "single" ? "block" : "none";
      document.getElementById("bulkBookForm").style.display = mode === "bulk" ? "block" : "none";
    }

    function addBook() {
      const title = document.getElementById("bookTitle").value;
      const author = document.getElementById("bookAuthor").value;
      const isbn = document.getElementById("bookISBN").value;
      if (!title || !author || !isbn) return showNotification("Please fill all fields", "error");
      if (books.some(b => b.isbn === isbn)) return showNotification("Duplicate ISBN!", "error");
      books.push({ title, author, isbn, available: true });
      saveData(); displayBooks(); updateDashboard();
      showNotification("Book added!");
    }

    function addBulkBooks() {
      const lines = document.getElementById("bulkBooks").value.trim().split("\n");
      let added = 0;
      lines.forEach(line => {
        const [title, author, isbn] = line.split(",");
        if (title && author && isbn && !books.some(b => b.isbn === isbn.trim())) {
          books.push({ title: title.trim(), author: author.trim(), isbn: isbn.trim(), available: true });
          added++;
        }
      });
      saveData(); displayBooks(); updateDashboard();
      showNotification(`${added} books added`);
    }

    function displayBooks() {
      const search = document.getElementById("bookSearch").value.toLowerCase();
      const list = document.getElementById("bookList");
      const filtered = books.filter(b => b.title.toLowerCase().includes(search));
      if (filtered.length === 0) return list.innerHTML = "<p>No books match your search.</p>";
      list.innerHTML = `<table><tr><th>Title</th><th>Author</th><th>ISBN</th><th>Status</th></tr>` +
        filtered.map(b => `<tr><td>${b.title}</td><td>${b.author}</td><td>${b.isbn}</td><td>${b.available ? "Available" : "Borrowed"}</td></tr>`).join("") +
        "</table>";
    }

    function addStudent() {
      const name = document.getElementById("studentName").value;
      const grade = document.getElementById("studentGrade").value;
      const email = document.getElementById("studentEmail").value;
      if (!name || !grade || !email) return showNotification("Please fill all fields", "error");
      const id = Date.now();
      students.push({ id, name, grade, email, borrowedBooks: [] });
      saveData(); displayStudents(); updateDashboard();
      showNotification("Student added!");
    }

    function deleteStudent(id) {
      const s = students.find(st => st.id === id);
      if (s && s.borrowedBooks.length > 0) return showNotification("Student has borrowed books!", "error");
      students = students.filter(st => st.id !== id);
      saveData(); displayStudents(); updateDashboard();
      showNotification("Student deleted.");
    }

    function displayStudents() {
      const search = document.getElementById("studentSearch").value.toLowerCase();
      const list = document.getElementById("studentList");
      const filtered = students.filter(s => s.name.toLowerCase().includes(search));
      if (filtered.length === 0) return list.innerHTML = "<p>No students match your search.</p>";
      list.innerHTML = `<table><tr><th>Name</th><th>Grade</th><th>Email</th><th>Borrowed</th><th></th></tr>` +
        filtered.map(s => `<tr><td>${s.name}</td><td>${s.grade}</td><td>${s.email}</td><td>${s.borrowedBooks.length}</td><td><button class="danger" onclick="deleteStudent(${s.id})">X</button></td></tr>`).join("") +
        "</table>";
    }

    function updateBorrowDropdowns() {
      const s = document.getElementById("borrowStudent");
      const b = document.getElementById("borrowBook");
      s.innerHTML = students.map(st => `<option value="${st.id}">${st.name}</option>`).join("");
      b.innerHTML = books.filter(book => book.available).map(book => `<option value="${book.isbn}">${book.title}</option>`).join("");
      displayReturnList();
    }

    function borrowBook() {
      const studentId = +document.getElementById("borrowStudent").value;
      const isbn = document.getElementById("borrowBook").value;
      const student = students.find(s => s.id === studentId);
      const book = books.find(b => b.isbn === isbn);
      if (!student || !book || !book.available) return showNotification("Invalid selection", "error");
      student.borrowedBooks.push(book.isbn);
      book.available = false;
      borrowings.push({ studentId, isbn, date: new Date().toISOString() });
      saveData(); updateDashboard();
      showNotification("Book borrowed!");
      updateBorrowDropdowns();
    }

    function returnBook(studentId, isbn) {
      const student = students.find(s => s.id === studentId);
      const book = books.find(b => b.isbn === isbn);
      if (student && book) {
        student.borrowedBooks = student.borrowedBooks.filter(b => b !== isbn);
        book.available = true;
        borrowings = borrowings.filter(b => !(b.studentId === studentId && b.isbn === isbn));
        saveData(); updateDashboard();
        showNotification("Book returned.");
        updateBorrowDropdowns();
      }
    }

    function displayReturnList() {
      const div = document.getElementById("returnList");
      let html = "";
      students.forEach(s => {
        if (s.borrowedBooks.length > 0) {
          html += `<p><strong>${s.name}</strong></p><ul>`;
          s.borrowedBooks.forEach(isbn => {
            const book = books.find(b => b.isbn === isbn);
            html += `<li>${book.title} <button onclick="returnBook(${s.id}, '${isbn}')">Return</button></li>`;
          });
          html += "</ul>";
        }
      });
      div.innerHTML = html || "<p>No active borrowings.</p>";
    }

    function updateDashboard() {
      document.getElementById("totalBooks").innerText = books.length;
      document.getElementById("totalStudents").innerText = students.length;
      document.getElementById("totalBorrowed").innerText = books.filter(b => !b.available).length;
    }

    function exportData() {
      const data = { books, students, borrowings };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "library-data.json";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
